--[[
    Script: Zenith UI for 99 Noites na Floresta
    Versão: 3.0
    Inspirado por: Solicitação de design do usuário
    Funcionalidades:
    - UI Profissional com sistema de categorias (API interna)
    - Sistema de Chave de Acesso
    - Comandos do jogo + Sistema de ESP completo (Players, Mobs, Recursos)
]]

--================================================================================================--
-- [ CONFIGURAÇÕES E SERVIÇOS ]
--================================================================================================--
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local Camera = Workspace.CurrentCamera

local Config = {
    Key = "ZENITH-99-PRO-V3",
    WindowTitle = "99 Noites - Painel Zenith"
}

-- Variáveis para controle do ESP
local ESP_Settings = {
    Players = false,
    Mobs = false,
    Wood = false,
    Coal = false
}
local ESP_Container = Instance.new("ScreenGui")
ESP_Container.Name = "ESP_Container"
ESP_Container.Parent = PlayerGui
ESP_Container.ZIndexBehavior = Enum.ZIndexBehavior.Global

--================================================================================================--
-- [ API DE UI ZENITH (Biblioteca interna para criar o menu) ]
--================================================================================================--
local Zenith = {}
Zenith.ActiveCategory = nil
Zenith.Pages = {}

function Zenith:CreateWindow(title)
    -- Janela Principal
    local MainWindow = Instance.new("Frame")
    MainWindow.Name = "MainWindow"
    MainWindow.Size = UDim2.new(0, 550, 0, 350)
    MainWindow.Position = UDim2.new(0.5, -275, 0.5, -175)
    MainWindow.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
    MainWindow.BorderColor3 = Color3.fromRGB(80, 80, 90)
    MainWindow.Draggable = true
    MainWindow.Active = true
    Instance.new("UICorner", MainWindow).CornerRadius = UDim.new(0, 6)

    -- Cabeçalho
    local Header = Instance.new("Frame")
    Header.Name = "Header"
    Header.Parent = MainWindow
    Header.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    Header.Size = UDim2.new(1, 0, 0, 30)
    local HeaderCorner = Instance.new("UICorner", Header)
    HeaderCorner.CornerRadius = UDim.new(0, 6)

    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Name = "TitleLabel"
    TitleLabel.Parent = Header
    TitleLabel.Size = UDim2.new(1, -10, 1, 0)
    TitleLabel.Position = UDim2.new(0, 5, 0, 0)
    TitleLabel.Text = title
    TitleLabel.Font = Enum.Font.SourceSansSemibold
    TitleLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.BackgroundTransparency = 1

    -- Barra Lateral de Categorias
    local CategoriesBar = Instance.new("Frame")
    CategoriesBar.Name = "CategoriesBar"
    CategoriesBar.Parent = MainWindow
    CategoriesBar.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    CategoriesBar.Size = UDim2.new(0, 130, 1, -30)
    CategoriesBar.Position = UDim2.new(0, 0, 0, 30)
    local CategoryLayout = Instance.new("UIListLayout", CategoriesBar)
    CategoryLayout.Padding = UDim.new(0, 5)
    CategoryLayout.SortOrder = Enum.SortOrder.LayoutOrder

    -- Container de Conteúdo
    local ContentContainer = Instance.new("Frame")
    ContentContainer.Name = "ContentContainer"
    ContentContainer.Parent = MainWindow
    ContentContainer.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
    ContentContainer.Size = UDim2.new(1, -130, 1, -30)
    ContentContainer.Position = UDim2.new(0, 130, 0, 30)

    -- Adiciona os elementos à tabela da API para referência futura
    Zenith.MainWindow = MainWindow
    Zenith.CategoriesBar = CategoriesBar
    Zenith.ContentContainer = ContentContainer

    return Zenith
end

function Zenith:CreateCategory(name)
    local Page = Instance.new("ScrollingFrame")
    Page.Name = name .. "_Page"
    Page.Parent = Zenith.ContentContainer
    Page.Size = UDim2.new(1, 0, 1, 0)
    Page.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
    Page.BorderSizePixel = 0
    Page.CanvasSize = UDim2.new(0,0,2,0)
    Page.Visible = false
    local PageLayout = Instance.new("UIListLayout", Page)
    PageLayout.Padding = UDim.new(0, 8)
    PageLayout.SortOrder = Enum.SortOrder.LayoutOrder
    PageLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    Zenith.Pages[name] = Page

    local CategoryButton = Instance.new("TextButton")
    CategoryButton.Name = name
    CategoryButton.Parent = Zenith.CategoriesBar
    CategoryButton.Size = UDim2.new(1, 0, 0, 35)
    CategoryButton.Text = "  " .. name
    CategoryButton.Font = Enum.Font.SourceSans
    CategoryButton.TextSize = 16
    CategoryButton.TextColor3 = Color3.fromRGB(200, 200, 200)
    CategoryButton.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    CategoryButton.TextXAlignment = Enum.TextXAlignment.Left
    CategoryButton.BorderSizePixel = 0

    CategoryButton.MouseButton1Click:Connect(function()
        for i, v in pairs(Zenith.Pages) do
            v.Visible = false
        end
        for i, v in pairs(Zenith.CategoriesBar:GetChildren()) do
            if v:IsA("TextButton") then
                v.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
                v.TextColor3 = Color3.fromRGB(200, 200, 200)
            end
        end
        Page.Visible = true
        CategoryButton.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
        CategoryButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        Zenith.ActiveCategory = Page
    end)

    if not Zenith.ActiveCategory then
        CategoryButton:Invoke()
    end
    
    return Page
end

function Zenith:CreateButton(category, text, callback)
    local Button = Instance.new("TextButton")
    Button.Name = text
    Button.Parent = category
    Button.Size = UDim2.new(0.9, 0, 0, 40)
    Button.Text = text
    Button.Font = Enum.Font.SourceSansSemibold
    Button.TextColor3 = Color3.fromRGB(230, 230, 230)
    Button.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    Instance.new("UICorner", Button).CornerRadius = UDim.new(0, 4)
    Button.MouseButton1Click:Connect(callback)
end

function Zenith:CreateToggle(category, text, callback)
    local ToggleFrame = Instance.new("Frame")
    ToggleFrame.Name = text .. "_Toggle"
    ToggleFrame.Parent = category
    ToggleFrame.Size = UDim2.new(0.9, 0, 0, 40)
    ToggleFrame.BackgroundTransparency = 1

    local Label = Instance.new("TextLabel", ToggleFrame)
    Label.Size = UDim2.new(0.7, 0, 1, 0)
    Label.Text = text
    Label.Font = Enum.Font.SourceSans
    Label.TextColor3 = Color3.fromRGB(220, 220, 220)
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.BackgroundTransparency = 1

    local Switch = Instance.new("TextButton", ToggleFrame)
    Switch.Size = UDim2.new(0.25, 0, 0.8, 0)
    Switch.Position = UDim2.new(0.75, 0, 0.1, 0)
    Switch.BackgroundColor3 = Color3.fromRGB(80, 50, 50)
    Switch.Text = "OFF"
    Switch.Font = Enum.Font.SourceSansBold
    Switch.TextColor3 = Color3.fromRGB(230, 230, 230)
    Instance.new("UICorner", Switch).CornerRadius = UDim.new(0, 4)

    local IsOn = false
    Switch.MouseButton1Click:Connect(function()
        IsOn = not IsOn
        if IsOn then
            Switch.BackgroundColor3 = Color3.fromRGB(50, 80, 50)
            Switch.Text = "ON"
        else
            Switch.BackgroundColor3 = Color3.fromRGB(80, 50, 50)
            Switch.Text = "OFF"
        end
        callback(IsOn)
    end)
end

function Zenith:CreateLabel(category, text)
    local Label = Instance.new("TextLabel")
    Label.Parent = category
    Label.Size = UDim2.new(0.9, 0, 0, 20)
    Label.Text = text
    Label.Font = Enum.Font.SourceSansBold
    Label.TextColor3 = Color3.fromRGB(150, 150, 160)
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.BackgroundTransparency = 1
end

--================================================================================================--
-- [ LÓGICA DO ESP ]
--================================================================================================--
local function create_esp_element(parent_obj)
    local esp_element = {}
    
    local box = Instance.new("Frame")
    box.Parent = ESP_Container
    box.BorderSizePixel = 2
    box.BorderColor3 = Color3.fromRGB(0, 255, 255)
    box.BackgroundColor3 = Color3.fromRGB(0, 255, 255)
    box.BackgroundTransparency = 0.8
    box.ZIndex = 2
    
    local name_label = Instance.new("TextLabel")
    name_label.Parent = ESP_Container
    name_label.Font = Enum.Font.SourceSans
    name_label.TextSize = 14
    name_label.TextColor3 = Color3.fromRGB(255, 255, 255)
    name_label.BackgroundTransparency = 1
    name_label.ZIndex = 3
    
    esp_element.Box = box
    esp_element.NameLabel = name_label
    esp_element.Parent = parent_obj
    
    return esp_element
end

local esp_objects = {}

RunService.RenderStepped:Connect(function()
    ESP_Container.Enabled = (ESP_Settings.Players or ESP_Settings.Mobs or ESP_Settings.Wood or ESP_Settings.Coal)
    if not ESP_Container.Enabled then return end

    local objects_to_draw = {}
    
    if ESP_Settings.Players then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                table.insert(objects_to_draw, {obj = player.Character, name = player.Name, color = Color3.fromRGB(255, 50, 50)})
            end
        end
    end

    if ESP_Settings.Mobs then
        -- ATENÇÃO: O nome da pasta "Monsters" pode variar. Ajuste se necessário.
        local monsterFolder = Workspace:FindFirstChild("Monsters")
        if monsterFolder then
            for _, mob in pairs(monsterFolder:GetChildren()) do
                if mob:FindFirstChild("HumanoidRootPart") then
                    table.insert(objects_to_draw, {obj = mob, name = mob.Name, color = Color3.fromRGB(255, 120, 0)})
                end
            end
        end
    end

    if ESP_Settings.Wood or ESP_Settings.Coal then
        -- ATENÇÃO: A forma como os recursos são armazenados pode variar.
        for _, item in pairs(Workspace:GetDescendants()) do
            if ESP_Settings.Wood and item.Name == "Wood" and item:IsA("Part") then
                 table.insert(objects_to_draw, {obj = item, name = "Madeira", color = Color3.fromRGB(139, 69, 19)})
            end
            if ESP_Settings.Coal and item.Name == "Coal" and item:IsA("Part") then
                 table.insert(objects_to_draw, {obj = item, name = "Carvão", color = Color3.fromRGB(80, 80, 80)})
            end
        end
    end
    
    for _, esp_element in pairs(esp_objects) do
        esp_element.Box.Visible = false
        esp_element.NameLabel.Visible = false
    end

    for i, data in pairs(objects_to_draw) do
        local pos, on_screen = Camera:WorldToScreenPoint(data.obj:IsA("Model") and data.obj.PrimaryPart.Position or data.obj.Position)
        if on_screen then
            if not esp_objects[i] then
                esp_objects[i] = create_esp_element(data.obj)
            end
            
            local esp_element = esp_objects[i]
            esp_element.Box.Visible = true
            esp_element.NameLabel.Visible = true
            
            local size = math.clamp(5000 / pos.Z, 10, 100)
            esp_element.Box.Size = UDim2.fromOffset(size, size)
            esp_element.Box.Position = UDim2.fromOffset(pos.X - size/2, pos.Y - size/2)
            esp_element.Box.BorderColor3 = data.color
            esp_element.Box.BackgroundColor3 = data.color

            esp_element.NameLabel.Text = data.name
            esp_element.NameLabel.Position = UDim2.fromOffset(pos.X - (esp_element.NameLabel.TextBounds.X/2), pos.Y - size/2 - 20)
        end
    end
end)


--================================================================================================--
-- [ INICIALIZAÇÃO DO SCRIPT ]
--================================================================================================--
local function Main()
    -- Criar a UI
    local MainUI = Zenith:CreateWindow(Config.WindowTitle)
    
    local cat_principal = Zenith:CreateCategory("Principal")
    Zenith:CreateButton(cat_principal, "Modo Deus", function()
        LocalPlayer.Character.Humanoid.MaxHealth = math.huge; LocalPlayer.Character.Humanoid.Health = math.huge
    end)
    Zenith:CreateButton(cat_principal, "Bateria Infinita", function()
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Flashlight") then
            LocalPlayer.Character.Flashlight.Battery.Value = 9e9
        end
    end)
    Zenith:CreateButton(cat_principal, "Estamina Infinita", function()
        LocalPlayer.PlayerValues.Stamina.Value = LocalPlayer.PlayerValues.MaxStamina.Value
    end)
    Zenith:CreateButton(cat_principal, "Aumentar Velocidade (50)", function()
        LocalPlayer.Character.Humanoid.WalkSpeed = 50
    end)
    Zenith:CreateButton(cat_principal, "Resetar Velocidade", function()
        LocalPlayer.Character.Humanoid.WalkSpeed = 16
    end)

    local cat_mundo = Zenith:CreateCategory("Mundo")
    Zenith:CreateButton(cat_mundo, "Vencer a Noite", function()
        ReplicatedStorage.DefaultRemotes.NightEvent:FireServer("Win")
    end)
    Zenith:CreateButton(cat_mundo, "Teleportar p/ Loja", function()
        LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(-16, 5, 21)
    end)
    Zenith:CreateButton(cat_mundo, "Teleportar p/ Cabana", function()
        LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(205, 133, -342)
    end)

    local cat_esp = Zenith:CreateCategory("ESP")
    Zenith:CreateLabel(cat_esp, "Visuals")
    Zenith:CreateToggle(cat_esp, "ESP de Players", function(state) ESP_Settings.Players = state end)
    Zenith:CreateToggle(cat_esp, "ESP de Mobs", function(state) ESP_Settings.Mobs = state end)
    Zenith:CreateLabel(cat_esp, "Recursos")
    Zenith:CreateToggle(cat_esp, "ESP de Madeira", function(state) ESP_Settings.Wood = state end)
    Zenith:CreateToggle(cat_esp, "ESP de Carvão", function(state) ESP_Settings.Coal = state end)

    -- Adicionar a UI ao PlayerGui e esconder
    Zenith.MainWindow.Parent = PlayerGui
    Zenith.MainWindow.Visible = false

    -- Criar o botão 'C' para abrir/fechar
    local toggleButton = Instance.new("TextButton")
    toggleButton.Parent = PlayerGui
    toggleButton.Size = UDim2.new(0, 40, 0, 40)
    toggleButton.Position = UDim2.new(1, -50, 0, 10)
    toggleButton.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    toggleButton.Text = "C"
    toggleButton.Font = Enum.Font.SourceSansBold
    toggleButton.TextColor3 = Color3.fromRGB(220, 220, 220)
    Instance.new("UICorner", toggleButton).CornerRadius = UDim.new(0, 5)

    local function toggleVisibility()
        Zenith.MainWindow.Visible = not Zenith.MainWindow.Visible
    end
    toggleButton.MouseButton1Click:Connect(toggleVisibility)
    UserInputService.InputBegan:Connect(function(input, processed)
        if not processed and input.KeyCode == Enum.KeyCode.C then
            toggleVisibility()
        end
    end)
end

--================================================================================================--
-- [ SISTEMA DE CHAVE E CARREGAMENTO ]
--================================================================================================--
do
    local keyScreen = Instance.new("ScreenGui", PlayerGui)
    local frame = Instance.new("Frame", keyScreen)
    frame.Size = UDim2.new(0, 300, 0, 150)
    frame.Position = UDim2.new(0.5, -150, 0.5, -75)
    frame.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
    Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 6)
    
    local title = Instance.new("TextLabel", frame)
    title.Size = UDim2.new(1, 0, 0, 30)
    title.Text = "Autenticação"
    title.Font = Enum.Font.SourceSansSemibold
    title.TextColor3 = Color3.fromRGB(220, 220, 220)
    title.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    Instance.new("UICorner", title).CornerRadius = UDim.new(0, 6)
    
    local keyBox = Instance.new("TextBox", frame)
    keyBox.Size = UDim2.new(0.8, 0, 0, 35)
    keyBox.Position = UDim2.new(0.1, 0, 0.35, 0)
    keyBox.PlaceholderText = "Insira a chave"
    keyBox.ClearTextOnFocus = false
    keyBox.Font = Enum.Font.SourceSans
    keyBox.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    keyBox.TextColor3 = Color3.fromRGB(220, 220, 220)
    Instance.new("UICorner", keyBox).CornerRadius = UDim.new(0, 4)
    
    local submit = Instance.new("TextButton", frame)
    submit.Size = UDim2.new(0.8, 0, 0, 30)
    submit.Position = UDim2.new(0.1, 0, 0.7, 0)
    submit.Text = "Verificar"
    submit.Font = Enum.Font.SourceSansBold
    submit.BackgroundColor3 = Color3.fromRGB(80, 80, 90)
    submit.TextColor3 = Color3.fromRGB(220, 220, 220)
    Instance.new("UICorner", submit).CornerRadius = UDim.new(0, 4)
    
    submit.MouseButton1Click:Connect(function()
        if keyBox.Text == Config.Key then
            keyScreen:Destroy()
            Main()
        else
            submit.Text = "Chave Incorreta!"
            submit.BackgroundColor3 = Color3.fromRGB(120, 50, 50)
            wait(2)
            submit.Text = "Verificar"
            submit.BackgroundColor3 = Color3.fromRGB(80, 80, 90)
        end
    end)
end