--[[
    Calvo mod - Interface Futurista para Roblox
    Descrição: Um menu com design profissional, organizado em abas para comandos e gerenciamento de jogadores.
    Recursos: Noclip, Velocidade, Voo, Teleporte com Clique, Lista de Jogadores, Ações em Jogadores (incluindo copiar skin).
]]

-- SERVIÇOS DO ROBLOX
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

-- JOGADOR LOCAL
local jogadorLocal = Players.LocalPlayer
local mouse = jogadorLocal:GetMouse()

-- CONFIGURAÇÕES DO MOD
local config = {
    velocidadeAumentada = 120,
    poderVoo = 150,
    corPrincipal = Color3.fromRGB(0, 225, 255), -- Azul Ciano Futurista
    corFundo = Color3.fromRGB(20, 22, 28),
    corSecundaria = Color3.fromRGB(35, 38, 46),
    corTexto = Color3.fromRGB(255, 255, 255)
}

-- VARIÁVEIS DE ESTADO
local estados = {
    noclip = false,
    velocidade = false,
    voo = false,
    clickTeleport = false
}
local vooCorrendo = nil

-- DESTRÓI QUALQUER GUI ANTIGA PARA EVITAR DUPLICAÇÃO
if jogadorLocal.PlayerGui:FindFirstChild("CalvoModGui") then
    jogadorLocal.PlayerGui.CalvoModGui:Destroy()
end

-- CRIAÇÃO DA INTERFACE (GUI)
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "CalvoModGui"
screenGui.Parent = jogadorLocal:WaitForChild("PlayerGui")
screenGui.ResetOnSpawn = false

-- JANELA PRINCIPAL
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Parent = screenGui
mainFrame.BackgroundColor3 = config.corFundo
mainFrame.Position = UDim2.new(0.5, -200, 0.5, -200)
mainFrame.Size = UDim2.new(0, 400, 0, 400)
mainFrame.Active = true
mainFrame.Draggable = true
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 8)
local mainStroke = Instance.new("UIStroke", mainFrame)
mainStroke.Color = config.corPrincipal
mainStroke.Thickness = 1.5
mainStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

-- BARRA DE TÍTULO
local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Parent = mainFrame
titleBar.BackgroundColor3 = config.corSecundaria
titleBar.Size = UDim2.new(1, 0, 0, 35)
titleBar.BackgroundTransparency = 0.5
local titleCorner = Instance.new("UICorner", titleBar)
titleCorner.CornerRadius = UDim.new(0, 8)

local titleLabel = Instance.new("TextLabel")
titleLabel.Parent = titleBar
titleLabel.Size = UDim2.new(1, 0, 1, 0)
titleLabel.BackgroundColor3 = Color3.new()
titleLabel.BackgroundTransparency = 1
titleLabel.Font = Enum.Font.Code
titleLabel.TextColor3 = config.corPrincipal
titleLabel.Text = "Calvo mod"
titleLabel.TextSize = 20

-- BOTÃO DE FECHAR
local closeButton = Instance.new("TextButton")
closeButton.Parent = titleBar
closeButton.Size = UDim2.new(0, 25, 0, 25)
closeButton.Position = UDim2.new(1, -30, 0.5, -12.5)
closeButton.BackgroundColor3 = config.corFundo
closeButton.Text = "X"
closeButton.Font = Enum.Font.Code
closeButton.TextColor3 = config.corTexto
closeButton.TextSize = 16
Instance.new("UICorner", closeButton).CornerRadius = UDim.new(0, 4)
closeButton.MouseButton1Click:Connect(function() screenGui:Destroy() end)

-- CONTAINER DAS ABAS
local tabsContainer = Instance.new("Frame")
tabsContainer.Parent = mainFrame
tabsContainer.Size = UDim2.new(1, 0, 0, 40)
tabsContainer.Position = UDim2.new(0, 0, 0, 35)
tabsContainer.BackgroundTransparency = 1

-- CONTAINER DE CONTEÚDO
local contentContainer = Instance.new("Frame")
contentContainer.Parent = mainFrame
contentContainer.Size = UDim2.new(1, -10, 1, -80)
contentContainer.Position = UDim2.new(0, 5, 0, 75)
contentContainer.BackgroundTransparency = 1

-- PÁGINAS (ABAS)
local commandsPage = Instance.new("Frame")
commandsPage.Name = "CommandsPage"
commandsPage.Parent = contentContainer
commandsPage.Size = UDim2.new(1, 0, 1, 0)
commandsPage.BackgroundTransparency = 1
commandsPage.Visible = true
local commandsLayout = Instance.new("UIListLayout", commandsPage)
commandsLayout.Padding = UDim.new(0, 8)

local playersPage = Instance.new("ScrollingFrame")
playersPage.Name = "PlayersPage"
playersPage.Parent = contentContainer
playersPage.Size = UDim2.new(1, 0, 1, 0)
playersPage.BackgroundTransparency = 1
playersPage.BackgroundColor3 = config.corSecundaria
playersPage.BorderSizePixel = 0
playersPage.Visible = false
playersPage.CanvasSize = UDim2.new(0,0,0,0)
playersPage.ScrollBarThickness = 6
playersPage.ScrollBarImageColor3 = config.corPrincipal
Instance.new("UICorner", playersPage).CornerRadius = UDim.new(0, 6)
local playersLayout = Instance.new("UIListLayout", playersPage)
playersLayout.Padding = UDim.new(0, 5)
playersLayout.SortOrder = Enum.SortOrder.Name

-- BOTÕES DAS ABAS
local function createTabButton(text, pageToShow)
    local button = Instance.new("TextButton")
    button.Parent = tabsContainer
    button.Text = text
    button.Font = Enum.Font.Code
    button.TextSize = 16
    button.TextColor3 = config.corTexto
    button.BackgroundColor3 = config.corSecundaria
    button.BackgroundTransparency = 0.5
    button.Size = UDim2.new(0.5, -2.5, 1, 0)
    Instance.new("UICorner", button).CornerRadius = UDim.new(0, 6)
    local stroke = Instance.new("UIStroke", button)
    stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    stroke.Thickness = 1
    stroke.Color = config.corSecundaria
    
    button.MouseButton1Click:Connect(function()
        for _, child in ipairs(contentContainer:GetChildren()) do
            child.Visible = false
        end
        pageToShow.Visible = true
        
        for _, btn in ipairs(tabsContainer:GetChildren()) do
            if btn:IsA("TextButton") then
                btn.BackgroundTransparency = 0.5
                btn:FindFirstChildOfClass("UIStroke").Color = config.corSecundaria
            end
        end
        
        button.BackgroundTransparency = 0
        stroke.Color = config.corPrincipal
    end)
    return button
end

local commandsTab = createTabButton("Comandos", commandsPage)
local playersTab = createTabButton("Players", playersPage)
playersTab.Position = UDim2.new(0.5, 2.5, 0, 0)

-- Simula o clique inicial para definir a aba padrão
commandsTab.MouseButton1Click:Invoke()

-- FUNÇÃO PARA CRIAR BOTÕES DE AÇÃO (TOGGLE)
local function createToggleButton(text, page, callback)
    local button = Instance.new("TextButton")
    button.Parent = page
    button.Size = UDim2.new(1, 0, 0, 35)
    button.BackgroundColor3 = config.corSecundaria
    button.Font = Enum.Font.Code
    button.TextSize = 16
    button.Text = text .. " [OFF]"
    button.TextColor3 = config.corTexto
    Instance.new("UICorner", button).CornerRadius = UDim.new(0, 6)
    
    button.MouseButton1Click:Connect(function()
        local newState = callback()
        button.Text = text .. " [" .. (newState and "ON" or "OFF") .. "]"
        button.TextColor3 = newState and config.corPrincipal or config.corTexto
    end)
end

-- ### ABA DE COMANDOS ###
createToggleButton("No Clip", commandsPage, function()
    estados.noclip = not estados.noclip
    return estados.noclip
end)

createToggleButton("Velocidade", commandsPage, function()
    estados.velocidade = not estados.velocidade
    local char = jogadorLocal.Character
    if char and char:FindFirstChild("Humanoid") then
        char.Humanoid.WalkSpeed = estados.velocidade and config.velocidadeAumentada or 16
    end
    return estados.velocidade
end)

createToggleButton("Voar", commandsPage, function()
    estados.voo = not estados.voo
    if not estados.voo and vooCorrendo then
        vooCorrendo:Disconnect()
        vooCorrendo = nil
    end
    return estados.voo
end)

createToggleButton("Teleporte com Clique", commandsPage, function()
    estados.clickTeleport = not estados.clickTeleport
    return estados.clickTeleport
end)

-- ### ABA DE PLAYERS ###
local playerActionFrame = nil

local function copiarSkin(targetPlayer)
    pcall(function()
        local localChar = jogadorLocal.Character
        if not localChar then return end
        
        local description = Players:GetHumanoidDescriptionFromUserId(targetPlayer.UserId)
        localChar.Humanoid:ApplyDescription(description)
    end)
end

local function criarMenuDeAcoes(player)
    if playerActionFrame then playerActionFrame:Destroy() end
    
    playerActionFrame = Instance.new("Frame")
    playerActionFrame.Parent = mainFrame
    playerActionFrame.BackgroundColor3 = config.corFundo
    playerActionFrame.Size = UDim2.new(0, 150, 0, 220)
    playerActionFrame.Position = UDim2.new(0, mainFrame.AbsoluteSize.X + 5, 0, 0)
    Instance.new("UICorner", playerActionFrame).CornerRadius = UDim.new(0, 6)
    local actionStroke = Instance.new("UIStroke", playerActionFrame)
    actionStroke.Color = config.corPrincipal
    actionStroke.Thickness = 1
    
    local actionLayout = Instance.new("UIListLayout", playerActionFrame)
    actionLayout.Padding = UDim.new(0, 5)
    actionLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    
    local function createActionButton(text, callback)
        local button = Instance.new("TextButton")
        button.Parent = playerActionFrame
        button.Size = UDim2.new(1, -10, 0, 30)
        button.BackgroundColor3 = config.corSecundaria
        button.Text = text
        button.TextColor3 = config.corTexto
        button.Font = Enum.Font.Code
        button.TextSize = 14
        Instance.new("UICorner", button).CornerRadius = UDim.new(0, 4)
        button.MouseButton1Click:Connect(function()
            callback()
            playerActionFrame:Destroy()
        end)
    end

    createActionButton("Teleportar", function()
        local alvo = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
        if alvo then jogadorLocal.Character.HumanoidRootPart.CFrame = alvo.CFrame end
    end)
    createActionButton("Trazer", function()
        local alvo = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
        if alvo then alvo.CFrame = jogadorLocal.Character.HumanoidRootPart.CFrame end
    end)
    createActionButton("Copiar Skin", function() copiarSkin(player) end)
    createActionButton("Explodir", function()
        if player.Character then Instance.new("Explosion", workspace).Position = player.Character.HumanoidRootPart.Position end
    end)
    createActionButton("Matar", function() if player.Character then player.Character.Humanoid.Health = 0 end end)
    createActionButton("Kick", function() player:Kick("Você foi ejetado pelo Calvo mod.") end)
end

function atualizarListaJogadores()
    for _, child in ipairs(playersPage:GetChildren()) do
        if child:IsA("TextButton") then child:Destroy() end
    end
    
    local canvasY = 0
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= jogadorLocal then
            local playerButton = Instance.new("TextButton")
            playerButton.Name = player.Name
            playerButton.Parent = playersPage
            playerButton.BackgroundColor3 = config.corSecundaria
            playerButton.Size = UDim2.new(1, -10, 0, 30)
            playerButton.Text = player.Name
            playerButton.TextColor3 = config.corTexto
            playerButton.Font = Enum.Font.SourceSans
            playerButton.TextSize = 16
            Instance.new("UICorner", playerButton).CornerRadius = UDim.new(0, 4)
            
            canvasY = canvasY + 35
            
            playerButton.MouseButton1Click:Connect(function() criarMenuDeAcoes(player) end)
        end
    end
    playersPage.CanvasSize = UDim2.new(0, 0, 0, canvasY)
end

Players.PlayerAdded:Connect(atualizarListaJogadores)
Players.PlayerRemoving:Connect(atualizarListaJogadores)
atualizarListaJogadores()

-- ### LÓGICA PRINCIPAL (EXECUTADA EM LOOP) ###
RunService.RenderStepped:Connect(function()
    local char = jogadorLocal.Character
    if not char then return end
    
    if estados.noclip then
        for _, part in ipairs(char:GetDescendants()) do
            if part:IsA("BasePart") and part.CanCollide then
                part.CanCollide = false
            end
        end
    end
    
    local humanoid = char:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end
    
    if estados.voo then
        humanoid.PlatformStand = true
        if vooCorrendo == nil then
            vooCorrendo = UserInputService.InputBegan:Connect(function(input, gpe)
                if gpe then return end
                if estados.voo and char and char:FindFirstChild("HumanoidRootPart") then
                    if input.KeyCode == Enum.KeyCode.W then
                        char.HumanoidRootPart.Velocity = mouse.UnitRay.Direction * config.poderVoo
                    elseif input.KeyCode == Enum.KeyCode.S then
                        char.HumanoidRootPart.Velocity = -mouse.UnitRay.Direction * config.poderVoo
                    end
                end
            end)
        end
    elseif humanoid.PlatformStand then
        humanoid.PlatformStand = false
    end
end)

mouse.Button1Down:Connect(function()
    if estados.clickTeleport and jogadorLocal.Character and mouse.Target then
        jogadorLocal.Character.HumanoidRootPart.CFrame = CFrame.new(mouse.Hit.p + Vector3.new(0, 3, 0))
    end
    
    -- Fechar menu de ação ao clicar fora
    if playerActionFrame and not mouse.Target:IsDescendantOf(playerActionFrame) and not mouse.Target:IsDescendantOf(playersPage) then
        playerActionFrame:Destroy()
    end
end)